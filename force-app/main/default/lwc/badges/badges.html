<template>
    <template if:true={renderBadges}>
        <article class="slds-card">
            <div class="slds-card__header slds-grid slds-assistive-text">
                <header class="slds-media slds-media_center slds-has-flexi-truncate">
                    <div class="slds-media__body">
                        <h2 class="slds-card__header-title">
                            <a href="#" class="slds-card__header-link slds-truncate" title="Card Header">
                                <span>Merkelapper</span>
                            </a>
                        </h2>
                    </div>
                </header>
            </div>
            <lightning-layout>
                <lightning-layout-item padding="around-small">
                    <ul class="slds-list_horizontal slds-wrap">
                        <template for:each={badges} for:item="badge">
                            <li class="badge-wrapper slds-item slds-badge badge-neutral" key={badge.label}>
                                <c-popover
                                    link-label={badge.label}
                                    link-url={badge.url}
                                    tooltip="Forhåndsvis"
                                    title="Forhåndsvis"
                                    popover-width={badge.popoverWidth}
                                >
                                    <span slot="body">
                                        <ul
                                            style="display: flex; flex-wrap: wrap"
                                            class="slds-has-dividers_bottom-space"
                                        >
                                            <template for:each={badge.relatedRecords} for:item="relatedRecord">
                                                <li
                                                    class="slds-var-m-around_xx-small"
                                                    key={relatedRecord.id}
                                                    style={popoverTileStyle}
                                                >
                                                    <lightning-tile
                                                        label={relatedRecord.name}
                                                        href={relatedRecord.link}
                                                        type="media"
                                                    >
                                                        <lightning-icon
                                                            slot="media"
                                                            icon-name={relatedRecord.icon}
                                                            size="x-small"
                                                        ></lightning-icon>
                                                        <dl class="slds-list_horizontal slds-wrap">
                                                            <template for:each={relatedRecord.fields} for:item="field">
                                                                <dt
                                                                    key={field.label}
                                                                    class="slds-item_label slds-text-color_weak slds-truncate"
                                                                    title={field.label}
                                                                >
                                                                    {field.label}:
                                                                </dt>
                                                                <dd
                                                                    key={field.label}
                                                                    class="slds-item_detail slds-truncate"
                                                                    title={field.value}
                                                                >
                                                                    <c-formatted-field
                                                                        value={field.value}
                                                                        type={field.type}
                                                                    ></c-formatted-field>
                                                                </dd>
                                                            </template>
                                                        </dl>
                                                    </lightning-tile>
                                                </li>
                                            </template>
                                        </ul>
                                    </span>
                                </c-popover>

                                <template if:true={badge.helpText}>
                                    <lightning-helptext content={badge.helpText}></lightning-helptext>
                                </template>
                            </li>
                        </template>
                    </ul>
                </lightning-layout-item>
            </lightning-layout>
        </article>
    </template>
    <template if:false={renderBadges}
        ><div style="margin-bottom: calc(var(--lwc-cardSpacingMargin) * -1)"></div
    ></template>
</template>
